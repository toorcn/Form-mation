<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <style>
    body{
      font-family:Open Sans;
      margin:0;
    }
    .refresh-section{
      display:flex;
      padding:10px 15px;
      padding-bottom:0;
      flex-direction:row;
      align-items:center;
      justify-content:space-between;
    }
    .refresh-button, .submit{
        padding: 5px 10px;
        background-color: #405cf5;
        border-radius: 6px;
        border-width: 0;
        box-shadow: rgba(50, 50, 93, .1) 0 0 0 1px inset,rgba(50, 50, 93, .1) 0 2px 5px 0,rgba(0, 0, 0, .07) 0 1px 1px 0;
        box-sizing: border-box;
        color: #fff;
        cursor: pointer;
        outline: none;
        overflow: hidden;
        position: relative;
        text-align: center;
        text-transform: none;
        transform: translateZ(0);
        transition: all .2s,box-shadow .08s ease-in;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
    }
    .refresh-button:hover, .submit:hover{
      background-color: #3045BD;
    }
    .quota, .usage{
      padding-left:15px;
      margin-top:15px;
      margin-bottom:5px;
    }
    .dropdown-list{
      list-style:none;
      padding:0;
      margin: 0 15px;
      margin-bottom:20px;
    }
    .dropdown-list li{
      background-color:#f2f2f2;
      border-bottom: 1px #ccc solid;
    }
    .dropdown-list li:first:child{
      border-top: 1px #ccc solid;
    }
    .question{
      display:flex;
      align-items: center;
      padding: 10px 0;
      border-left: 5px #f2f2f2 solid;
      cursor:pointer;
      transition: 0.3s;
    }
    .question h5{
      margin: 0 15px;
    }
    .question:focus, .question:hover, .question:hover .arrow{
      border-left-color: #4056F4;
    }
    .arrow{
      margin: 0 0.5rem;
      width: 0;
      height: 0;
      border-top: 6px solid transparent;
      border-left: 10px solid #555;
      border-bottom: 6px solid transparent;
      transition:0.3s;
    }
    .arrow-rotated{
      transform: rotate(90deg);
    }
    .answer{
      overflow:hidden;
      height:0;
      transition:0.3s;
    }
    .answer p{
      line-height:20px;
      font-size:14px;
    }
    .answer div{
      padding:3px;
      line-height:5px;
    }
    .answer-opened{
      padding: 0 10px;
      height:initial;
    }
    .activity-log{
      background-color:#f2f2f2;
      height:50dvh;
      margin:0 15px;
      padding:0 15px;
      overflow-y:scroll;
      list-style:none;

      li{
        position: relative;
        padding-left: 20px;
        padding-right: 10px;
        border-bottom: 1px #ccc solid;

        &::after {
          content: "";
          display: block;
          position: absolute;
          top: 3px;
          left: -5px;
          width: 10px;
          height: 10px;
          border-radius: 50%;
          background: #fff;
          border: 2px solid #4056F4;
        }
      }
      li:last-child{
        border-bottom:none;
      }
      .activity-date{
        margin-bottom: -10px;
        font-size: 12px;
        color: #A9A9A9;
      }
      .activity-details{
        font-size: 14px;
      }

    }
    .activity-log::-webkit-scrollbar{
      width: 5px;
    }
    .activity-log::-webkit-scrollbar-track {
      background-color: #dedede; 
    }
    .activity-log::-webkit-scrollbar-thumb {
      border-top: 3px solid #dedede;
      border-bottom: 3px solid #dedede;
      background: #888; 
    }
    .activity-log::-webkit-scrollbar-thumb:hover {
      background: #555; 
    }
  </style>

  <body>
    <div class="refresh-section">
      <span style="font-size:10px;"><i>Information as of <span id="current-date"><?= getCurrentDate() ?></span>
      </i></span>
      <button type="button" class="refresh-button" onclick="refresh()"><i class="fa fa-refresh"></i> Refresh</button>
    </div>

    <h4 class="quota">Quota Remaining</h4>
    <p style="padding:0 25px;margin-top:0px;margin-bottom:30px;">Email : <span id="quota-email"><?= getEmailQuota() ?></span></p>

    <div style="display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:0 15px;margin-top:15px;margin-bottom:5px;">
      <h4 class="usage" style="margin:0;">Usage Information</h4>
      <input id="submit" class="submit" type="submit" value="See Details" onclick="window.open('https://docs.google.com/document/d/1moPFLLEPY92SxJPnF1Pszdktjk_y3QMcXAoW9gEWcPs/edit?usp=sharing', '_blank');" />
    </div>
    <ul class="dropdown-list">
      <li>
        <div class="question">
          <span class="arrow"></span>
          <h5>Text Placeholder</h5>
        </div>
        <div class="answer">
          <div>
            <h5>Format</h5>
            <p>{{[PLACEHOLDER NAME]}}</p>
          </div>
          <div>
            <h5>Example</h5>
            <p>{{Project Name}} or {{date}}</p>
          </div>
        </div>
      </li>

      <li>
        <div class="question">
          <span class="arrow"></span>
          <h5>Placeholder Image (Email, Doc-to-Doc, Doc-to-PDF)</h5>
        </div>
        <div class="answer">
          <div>
            <h5>Format</h5>
            <p>{{IMG-[S/M/L/Pixel Width]_[name]}}</p>
          </div>
          <div>
            <h5>Example</h5>
            <p>{{IMG-M_population}} or {{IMG-600_sales}}</p>
          </div>
        </div>
      </li>

      <li>
        <div class="question">
          <span class="arrow"></span>
          <h5>Placeholder Image (Slide-to-Slide, Slide-to-PDF)</h5>
        </div>
        <div class="answer">
          <div>
            <h5>Format</h5>
            <p>{{IMG_[name]}}</p>
          </div>
          <div>
            <h5>Example</h5>
            <p>{{IMG_Company Logo}}</p>
          </div>
          <p style="font-size:12px;padding:3px;">Note : The size of the image is only determined/limited by the size of the text box the placeholder belongs to (the image placeholder text must be at the start of the text box and any other text in the textbox is not maintained as the image replaces the whole text box)</p>
        </div>
      </li>
    </ul>
    
    <div style="display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:0 15px;margin-top:15px;margin-bottom:5px;">
      <h4 class="history" style="margin:0;">Activity History</h4>
      <input id="submit" class="submit" type="submit" value="Clear Logs" onclick="onClearLog()" />
    </div>
    <ul class="dropdown-list">
      <li>
        <div class="question">
          <span class="arrow"></span>
          <h5>Open Logs</h5>
        </div>
        <div class="answer">
          <ul class="activity-log" id="activity-log">
            <?!= getActivityHistory() ?>
          </ul>
        </div>
      </li>
    </ul>

  </body>

  <script>
    const question = document.querySelectorAll('.question'),
    answer = document.querySelectorAll('.answer'),
    arrow = document.querySelectorAll('.arrow');

    //Select all question elements
    for(let i = 0; i < question.length; i++){
      //Add click event
      question[i].addEventListener('click', () => {
        //Open the answer element
        answer[i].classList.toggle('answer-opened');
        //Rotate the arrow element
        arrow[i].classList.toggle('arrow-rotated');
      });
    }

    function onClearLog() {
      google.script.run.withSuccessHandler(onSuccess).clearActivityHistory();
    }

    function onSuccess() {
      const activityLog = document.getElementById("activity-log");

      activityLog.innerHTML = "";
    }

    function refresh() {
      const currentDate = document.getElementById("current-date");
      const quotaEmail = document.getElementById("quota-email");
      const activityLog = document.getElementById("activity-log");

      google.script.run.withSuccessHandler((value) => {
        quotaEmail.innerHTML = value;
      }).getEmailQuota();

      google.script.run.withSuccessHandler((value) => {
        if (!value) value = "";
        activityLog.innerHTML = value;
      }).getActivityHistory();

      google.script.run.withSuccessHandler((value) => {
        currentDate.innerHTML = value;
      }).getCurrentDate();
      
    }
  </script>
</html>